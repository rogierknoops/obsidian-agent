# Obsidian Vault Agent - Project Rules

## Project Overview
This is a Python CLI agent that uses OpenAI's GPT-4o to analyze and modify files in an Obsidian vault. It runs from the terminal and provides an interactive chat interface.

## Tech Stack
- Python 3.10+
- OpenAI API (GPT-4o) with function calling/tools
- Click for CLI
- Rich for terminal UI
- python-dotenv for configuration

## Project Structure
```
obsidian-agent/
├── main.py           # Entry point
├── src/
│   ├── cli.py        # CLI interface with Click + Rich
│   ├── agent.py      # OpenAI agent with tool-use
│   └── vault.py      # Vault file operations
```

## Code Style
- Use type hints for all function parameters and return values
- Use dataclasses for data structures
- Keep functions focused and single-purpose
- Handle errors gracefully with user-friendly messages
- Use Rich for all terminal output formatting

## Key Conventions
- Vault operations go in `vault.py`
- AI/LLM logic goes in `agent.py`
- CLI commands and UI go in `cli.py`
- Environment variables: `OPENAI_API_KEY`, `OBSIDIAN_VAULT_PATH`
- The agent uses OpenAI's tool/function calling pattern

## Tool Definitions
The agent has these tools available:
- `list_files` - List markdown files (with optional glob pattern)
- `read_file` - Read file content
- `write_file` - Write/update files
- `search` - Search content across files
- `tree` - Show vault folder structure

## When Adding Features
1. New vault operations → add to `VaultManager` class in `vault.py`
2. New AI tools → add to `self.tools` list in `VaultAgent` class and implement in `_execute_tool()`
3. New CLI commands → add with `@cli.command()` decorator in `cli.py`

---

# Obsidian Vault Agent Rules

## Scope

- This is an Obsidian vault. All files are user notes.
- Only edit Markdown files: `**/*.md`.
- Never touch:
  - `.obsidian/**`
  - `.git/**`
  - Any non-Markdown file (PDF, PNG, etc.).

## Safety

- **Before editing any files, commit current vault state to GitHub backup** (`obsidian-backup` repo).
- Before bulk edits, explain the planned changes in bullets.
- Prefer editing specific files or folders; avoid global transforms unless explicitly asked.
- Never delete files. Use Obsidian-style archiving instead (e.g. move to an `_archive` folder) if instructed.

## Style + Structure

- Preserve existing frontmatter and YAML keys.
- Preserve Obsidian link syntax: `[[Page Name]]`, `[[Page Name|Alias]]`, `![[Embeds]]`.
- Preserve and do not break Dataview or Advanced URI snippets.
- For code blocks, keep the language tag and fenced formatting.

## Dataview

- Do not change the structure of Dataview queries unless explicitly asked.
- When modifying tables or properties consumed by Dataview, keep field names stable.

## Editing Behavior

- When refactoring a note:
  - Keep headings hierarchy intact unless a better hierarchy is clearly required.
  - Keep backlinks meaningful; do not rename pages without updating all references.
- When renaming files:
  - Update all `[[wikilinks]]` to match the new name in the entire vault.
  - Never change note IDs if the vault uses them for linking.

## Output

- When you finish a task, list:
  - Files you changed
  - What you changed in each file (1–3 bullets per file)

---

## Testing
- Test with a real Obsidian vault
- Use `/tree` and `/files` commands to verify vault access
- Test file modifications on non-critical notes first
