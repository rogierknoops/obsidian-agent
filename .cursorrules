# Obsidian Vault Agent

An AI-powered CLI agent using OpenAI GPT-4o to analyze and modify Obsidian vault files.

---

## Part 1: Development Rules

### Tech Stack
- Python 3.10+
- OpenAI API (GPT-4o) with function calling
- Click (CLI), Rich (terminal UI), python-dotenv (config)

### Project Structure
```
obsidian-agent/
├── main.py           # Entry point
├── src/
│   ├── cli.py        # CLI commands + Rich UI
│   ├── agent.py      # OpenAI agent with tools
│   └── vault.py      # Vault file operations
```

### Code Style
- Type hints for all function parameters and return values
- Dataclasses for data structures
- Single-purpose functions
- Rich for all terminal output
- Graceful error handling with user-friendly messages

### Environment Variables
- `OPENAI_API_KEY`
- `OBSIDIAN_VAULT_PATH`

### Agent Tools
- `list_files` - List markdown files (optional glob pattern)
- `read_file` - Read file content
- `write_file` - Write/update files
- `search` - Search content across files
- `tree` - Show vault folder structure
- `list_tags` - List all tags across entire vault with file counts
- `list_yaml_keys` - List all unique YAML frontmatter keys with file counts

### Default Full-Scope Scan
- On conversation start, the agent auto-scans the entire vault to collect:
  - Complete file list (Markdown only)
  - All tags with file counts
  - All YAML frontmatter keys with file counts
- This summary is provided to the model by default; per-file content is loaded only when requested.

### Backups
- Optional `--auto-backup` flag (chat/ask) will create a git commit in the vault before edits (no push).
- Default commit message: "Add a description of the changes" (you can edit at prompt).
- You must push manually after reviewing: `git push`.
### Adding Features
1. Vault operations → `VaultManager` class in `vault.py`
2. AI tools → `self.tools` list + `_execute_tool()` in `agent.py`
3. CLI commands → `@cli.command()` decorator in `cli.py`

### Testing
- Test with a real Obsidian vault
- Use `/tree` and `/files` commands to verify vault access
- Test file modifications on non-critical notes first

---

## Part 2: Vault Editing Rules

### Scope
- Only edit Markdown files (`**/*.md`)
- Never touch `.obsidian/**`, `.git/**`, or non-Markdown files (PDF, PNG, etc.)

### Safety
1. **Before editing any files**, commit current vault state to GitHub backup (`obsidian-backup` repo)
2. Before bulk edits, explain planned changes in bullets
3. Prefer editing specific files/folders; avoid global transforms unless explicitly asked
4. Never delete files — use Obsidian-style archiving (`_archive/` folder) if instructed

### Preserve Obsidian Syntax
- Frontmatter and YAML keys
- Wikilinks: `[[Page Name]]`, `[[Page Name|Alias]]`
- Embeds: `![[Embeds]]`
- Dataview queries and Advanced URI snippets
- Code blocks with language tags

### Dataview
- Do not change Dataview query structure unless explicitly asked
- Keep field names stable when modifying properties consumed by Dataview

### Editing Behavior
- Keep heading hierarchy intact unless a better structure is clearly required
- Keep backlinks meaningful — do not rename pages without updating all references
- When renaming files, update all `[[wikilinks]]` in the entire vault
- Never change note IDs if the vault uses them for linking

### Output
After completing a task, list:
- Files changed
- What changed in each file (1–3 bullets per file)
